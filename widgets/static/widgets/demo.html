<!DOCTYPE HTML>
<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Highcharts Examples</title>

    <!-- This is where we define location of data server. -->
    <script src="/static/js/widgets/settings.js"></script>
    
    <script src="/static/js/jquery/jquery-3.1.1.min.js"></script>

    <!-- For highcharts-widget.js -->
    <script src="/static/js/highcharts/code/highstock.js"></script>
    <script src="/static/js/highcharts/code/highcharts-more.js"></script>
    <script src="/static/js/highcharts/code/modules/data.js"></script>
    <script src="/static/js/highcharts/code/modules/exporting.js"></script>
    <script src="/static/js/highcharts/code/modules/export-data.js"></script>

    <script src="/static/js/widgets/highcharts_widget.js"></script>
    <script src="/static/js/widgets/text_widget.js"></script>
    <script src="/static/js/widgets/widget_server.js"></script>

    <style type="text/css">
      .ship_table {
        font-family: "Trebuchet MS", Arial, Helvetica, sans-serif;
        border-collapse: collapse;
        width: 100%;
      }
      .ship_table td, .ship_table th {
        border: 1px solid #ddd;
        padding: 8px;
        text-align: center;
        width: 50%;
      }
    </style>
  </head>
  <body>
    <table class=ship_table>
      <tr>
        <td>
          <div id="line-container" style="height: 400px; min-width: 310px"></div>
        </td>
        <td>
          <div id="dial-container" style="height: 400px; min-width: 310px"></div>
        </td>
      </tr>
      <tr>
        <td>Attitude:
          <span id="pitch_container"></span>,
          <span id="roll_container"></span>
        </td>
        <td>Relative Speed:
          Port: <span id="port_rel_speed" style="color:red"></span> m/s,
          Stbd: <span id="stbd_rel_speed" style="color:green"></span> m/s
        </td>
      </tr>
      <tr>
        <td colspan=2>Position:
          <span id="gps_lat_container">-</span>째
          <span id="gps_n_or_s_container"></span>, 
          <span id="gps_lon_container">-</span>째
          <span id="gps_e_or_w_container"></span>
        </td>
      </tr>
    </table>

    <script type="text/javascript">
      //////////////////////////////////////
      // Start of widget code
      var widget_list = [];

      //////////////////
      // A line widget
      var line_fields = {
        S330Pitch: {
          name: "Pitch",
          seconds: 30
        },
        S330Roll: {
          name: "Roll",
          seconds: 30
        }
      };
      widget_list.push(new TimelineWidget('line-container',
                                          line_fields, 'Degrees'));

      //////////////////
      // A dial
      var dial_fields = {
        MwxPortRelWindDir: {
          name: 'Port Relative Wind',
          color: 'red',
        },
        MwxStbdRelWindDir: {
          name: 'Stbd Relative Wind',
          color: 'green',
        }
      };
      widget_list.push(new DialWidget('dial-container', dial_fields));


      //////////////////
      // Some basic row data, both singular and compound
      var pitch_fields = {
        S330Pitch: {
          name: "Pitch",
          transform: function(val) { return 'Pitch ' + val + '째'; }
        }
      };
      widget_list.push(new TextWidget('pitch_container',
                                      pitch_fields, 'Degrees'));

      var roll_fields = {
        S330Roll: {
          name: "Roll",
          transform: function(val) { return 'Roll ' + val + '째'; }
        }
      };
      widget_list.push(new TextWidget('roll_container', roll_fields, 'Degrees'));

      var port_rel_speed_fields = {
        MwxPortRelWindSpeed: {
          name: "Port Rel Wind Speed",
        }
      };
      widget_list.push(new TextWidget('port_rel_speed', port_rel_speed_fields));

      var stbd_rel_speed_fields = {
        MwxStbdRelWindSpeed: {
          name: "Stbd Rel Wind Speed",
        }
      };
      widget_list.push(new TextWidget('stbd_rel_speed', stbd_rel_speed_fields));

      var gps_lat_fields = {
        S330Lat: {
          name: "Latitude",
          transform: function(val) {
            return 'Lat ' + Math.round(val*100)/10000;
          }
        }
      };
      var gps_n_or_s_fields = {
        S330NorS: {
          name: "N/S",
        }
      };
      widget_list.push(new TextWidget('gps_lat_container', gps_lat_fields));
      widget_list.push(new TextWidget('gps_n_or_s_container',
                                      gps_n_or_s_fields));

      var gps_lon_fields = {
        S330Lon: {
          name: "Longitude",
          transform: function(val) {
            return 'Lon ' + Math.round(val*100)/10000;
          }
        }
      };
      var gps_e_or_w_fields = {
        S330EorW: {
          name: "E/W",
        }
      };
      widget_list.push(new TextWidget('gps_lon_container', gps_lon_fields));
      widget_list.push(new TextWidget('gps_e_or_w_container',
                                      gps_e_or_w_fields));

      var widget_server = new WidgetServer(widget_list,
                                           WEBSOCKET_DATA_SERVER);
      widget_server.serve();

    </script>
  </body>
</html>
