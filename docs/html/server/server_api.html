<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1" />
<meta name="generator" content="pdoc 0.10.0" />
<title>server.server_api API documentation</title>
<meta name="description" content="API for interacting with data store. Implementations should subclass." />
<link rel="preload stylesheet" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/11.0.1/sanitize.min.css" integrity="sha256-PK9q560IAAa6WVRRh76LtCaI8pjTJ2z11v0miyNNjrs=" crossorigin>
<link rel="preload stylesheet" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/11.0.1/typography.min.css" integrity="sha256-7l/o7C8jubJiy74VsKTidCy1yBkRtiUGbVkYBylBqUg=" crossorigin>
<link rel="stylesheet preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/styles/github.min.css" crossorigin>
<style>:root{--highlight-color:#fe9}.flex{display:flex !important}body{line-height:1.5em}#content{padding:20px}#sidebar{padding:30px;overflow:hidden}#sidebar > *:last-child{margin-bottom:2cm}.http-server-breadcrumbs{font-size:130%;margin:0 0 15px 0}#footer{font-size:.75em;padding:5px 30px;border-top:1px solid #ddd;text-align:right}#footer p{margin:0 0 0 1em;display:inline-block}#footer p:last-child{margin-right:30px}h1,h2,h3,h4,h5{font-weight:300}h1{font-size:2.5em;line-height:1.1em}h2{font-size:1.75em;margin:1em 0 .50em 0}h3{font-size:1.4em;margin:25px 0 10px 0}h4{margin:0;font-size:105%}h1:target,h2:target,h3:target,h4:target,h5:target,h6:target{background:var(--highlight-color);padding:.2em 0}a{color:#058;text-decoration:none;transition:color .3s ease-in-out}a:hover{color:#e82}.title code{font-weight:bold}h2[id^="header-"]{margin-top:2em}.ident{color:#900}pre code{background:#f8f8f8;font-size:.8em;line-height:1.4em}code{background:#f2f2f1;padding:1px 4px;overflow-wrap:break-word}h1 code{background:transparent}pre{background:#f8f8f8;border:0;border-top:1px solid #ccc;border-bottom:1px solid #ccc;margin:1em 0;padding:1ex}#http-server-module-list{display:flex;flex-flow:column}#http-server-module-list div{display:flex}#http-server-module-list dt{min-width:10%}#http-server-module-list p{margin-top:0}.toc ul,#index{list-style-type:none;margin:0;padding:0}#index code{background:transparent}#index h3{border-bottom:1px solid #ddd}#index ul{padding:0}#index h4{margin-top:.6em;font-weight:bold}@media (min-width:200ex){#index .two-column{column-count:2}}@media (min-width:300ex){#index .two-column{column-count:3}}dl{margin-bottom:2em}dl dl:last-child{margin-bottom:4em}dd{margin:0 0 1em 3em}#header-classes + dl > dd{margin-bottom:3em}dd dd{margin-left:2em}dd p{margin:10px 0}.name{background:#eee;font-weight:bold;font-size:.85em;padding:5px 10px;display:inline-block;min-width:40%}.name:hover{background:#e0e0e0}dt:target .name{background:var(--highlight-color)}.name > span:first-child{white-space:nowrap}.name.class > span:nth-child(2){margin-left:.4em}.inherited{color:#999;border-left:5px solid #eee;padding-left:1em}.inheritance em{font-style:normal;font-weight:bold}.desc h2{font-weight:400;font-size:1.25em}.desc h3{font-size:1em}.desc dt code{background:inherit}.source summary,.git-link-div{color:#666;text-align:right;font-weight:400;font-size:.8em;text-transform:uppercase}.source summary > *{white-space:nowrap;cursor:pointer}.git-link{color:inherit;margin-left:1em}.source pre{max-height:500px;overflow:auto;margin:0}.source pre code{font-size:12px;overflow:visible}.hlist{list-style:none}.hlist li{display:inline}.hlist li:after{content:',\2002'}.hlist li:last-child:after{content:none}.hlist .hlist{display:inline;padding-left:1em}img{max-width:100%}td{padding:0 .5em}.admonition{padding:.1em .5em;margin-bottom:1em}.admonition-title{font-weight:bold}.admonition.note,.admonition.info,.admonition.important{background:#aef}.admonition.todo,.admonition.versionadded,.admonition.tip,.admonition.hint{background:#dfd}.admonition.warning,.admonition.versionchanged,.admonition.deprecated{background:#fd4}.admonition.error,.admonition.danger,.admonition.caution{background:lightpink}</style>
<style media="screen and (min-width: 700px)">@media screen and (min-width:700px){#sidebar{width:30%;height:100vh;overflow:auto;position:sticky;top:0}#content{width:70%;max-width:100ch;padding:3em 4em;border-left:1px solid #ddd}pre code{font-size:1em}.item .name{font-size:1em}main{display:flex;flex-direction:row-reverse;justify-content:flex-end}.toc ul ul,#index ul{padding-left:1.5em}.toc > ul > li{margin-top:.5em}}</style>
<style media="print">@media print{#sidebar h1{page-break-before:always}.source{display:none}}@media print{*{background:transparent !important;color:#000 !important;box-shadow:none !important;text-shadow:none !important}a[href]:after{content:" (" attr(href) ")";font-size:90%}a[href][title]:after{content:none}abbr[title]:after{content:" (" attr(title) ")"}.ir a:after,a[href^="javascript:"]:after,a[href^="#"]:after{content:""}pre,blockquote{border:1px solid #999;page-break-inside:avoid}thead{display:table-header-group}tr,img{page-break-inside:avoid}img{max-width:100% !important}@page{margin:0.5cm}p,h2,h3{orphans:3;widows:3}h1,h2,h3,h4,h5,h6{page-break-after:avoid}}</style>
<script defer src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/highlight.min.js" integrity="sha256-Uv3H6lx7dJmRfRvH8TH6kJD1TSK1aFcwgx+mdg3epi8=" crossorigin></script>
<script>window.addEventListener('DOMContentLoaded', () => hljs.initHighlighting())</script>
</head>
<body>
<main>
<article id="content">
<header>
<h1 class="title">Module <code>server.server_api</code></h1>
</header>
<section id="section-intro">
<p>API for interacting with data store. Implementations should subclass.</p>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">#!/usr/bin/env python3
&#34;&#34;&#34;
API for interacting with data store. Implementations should subclass.
&#34;&#34;&#34;
import logging
import sys


################################################################################
class ServerAPI:
    &#34;&#34;&#34;Abstract base class defining an API through which a LoggerServer
    can interact with a data store.

    Parameters below have the following semantics:
    ```
    configuration - dict definition of a OpenRVDAS configuration
    mode          - dict name of mode, and logger_config_names associated with that mode
    default_mode  - name of mode to use at startup or when returning to a default state

    logger_config_name - string name of a logger configuration, unique within configration
    logger_config - dict definition of a logger configuration

    logger_id     - string name of logger, unique within cruise
    logger        - dict definition of logger, including list of names of
                    valid configs and optional host restriction

    logger_configs - dict of {logger_config_name:logger_config,...}
    ```
    For the purposes of documentation below, assume a sample
    cruise_config as follows:
    ```
    {
      &#34;loggers&#34;: {
        &#34;knud&#34;: {
          &#34;host&#34;: &#34;knud.pi&#34;,
          &#34;configs&#34;: [&#34;off&#34;, &#34;knud-&gt;net&#34;, &#34;knud-&gt;file/net/db&#34;]
        },
        &#34;gyr1&#34;: {
          &#34;configs&#34;: [&#34;off&#34;, &#34;gyr1-&gt;net&#34;, &#34;gyr1-&gt;file/net/db&#34;]
        },
      &#34;modes&#34;: {
        &#34;off&#34;: {&#34;knud&#34;: &#34;off&#34;, &#34;gyr1&#34;: &#34;off&#34;},
        &#34;port&#34;: {&#34;knud&#34;: &#34;off&#34;, &#34;gyr1&#34;: &#34;gyr1-&gt;net&#34;},
        &#34;underway&#34;: { &#34;knud&#34;: &#34;knud-&gt;file/net/db&#34;,
                      &#34;gyr1&#34;: &#34;gyr1-&gt;file/net/db&#34;
                    }
      },
      &#34;default_mode&#34;: &#34;off&#34;,
      &#34;configs&#34;: {
        &#34;off&#34;: {},
        &#34;knud-&gt;net&#34;: { config_spec },
        &#34;knud-&gt;file/net/db&#34;: { config_spec },
        &#34;gyr1-&gt;net&#34;: { config_spec },
        &#34;gyr1-&gt;file/net/dbnet&#34;: { config_spec }
      }
    }
    ```
    &#34;&#34;&#34;

    ############################
    def __init__(self):
        # Called when we update which configs are active.
        self.update_callbacks = []

        # Called when the set of configs changes.
        self.load_callbacks = []

        # Called, obviously, when &#39;quit&#39; is signalled.
        self.quit_callbacks = []

    #############################
    # API methods below are used in querying/modifying the API for the
    # record of the running state of loggers.
    #############################
    # def get_cruises(self):
    #   &#34;&#34;&#34;Return list of cruise id&#39;s. Returns, e.g.
    #   &gt; api.get_cruises()
    #       [&#34;NBP1700&#34;, &#34;NBP1701&#34;]
    #   &#34;&#34;&#34;
    #   raise NotImplementedError(&#39;get_cruises must be implemented by subclass&#39;)

    #############################
    def get_configuration(self):
        &#34;&#34;&#34;Get OpenRVDAS configuration from the data store.
        &#34;&#34;&#34;
        raise NotImplementedError(&#39;get_configuration must be implemented by subclass&#39;)

    #############################
    def get_modes(self):
        &#34;&#34;&#34;Get the list of modes from the data store.
        &gt; api.get_modes()
            [&#34;off&#34;, &#34;port&#34;, &#34;underway&#34;]
        &#34;&#34;&#34;
        raise NotImplementedError(&#39;get_modes must be implemented by subclass&#39;)

    #############################
    def get_active_mode(self):
        &#34;&#34;&#34;Get the currently active mode from the data store.
        &gt; api.get_active_mode()
            &#34;port&#34;
        &#34;&#34;&#34;
        raise NotImplementedError(&#39;get_active_mode must be implemented by subclass&#39;)

    #############################
    def get_default_mode(self):
        &#34;&#34;&#34;Get the default mode from the data store.
        &gt; api.get_default_mode()
            &#34;off&#34;
        &#34;&#34;&#34;
        raise NotImplementedError(&#39;get_default_mode must be implemented by subclass&#39;)

    #############################
    def get_loggers(self):
        &#34;&#34;&#34;Get the dict of {logger_id:logger_spec,...} from the data store.
        &gt; api.get_loggers()
            {
              &#34;knud&#34;: {&#34;host&#34;: &#34;knud.pi&#34;, &#34;configs&#34;:...},
              &#34;gyr1&#34;: {&#34;configs&#34;:...}
            }
        &#34;&#34;&#34;
        raise NotImplementedError(&#39;get_loggers must be implemented by subclass&#39;)

    #############################
    def get_logger(self, logger_id):
        &#34;&#34;&#34;Retrieve the logger spec for the specified logger id.
        &gt; api.get_logger(&#39;knud&#39;)
            {&#34;name&#34;: &#34;knud-&gt;net&#34;, &#34;host_id&#34;: &#34;knud.pi&#34;, &#34;configs&#34;:...}
        &#34;&#34;&#34;
        raise NotImplementedError(&#39;get_logger must be implemented by subclass&#39;)

    #############################
    def get_logger_config(self, config_name):
        &#34;&#34;&#34;Retrieve the logger config associated with the specified name.
        &gt; api.get_logger_config(&#39;knud-&gt;net&#39;)
               { &#34;readers&#34;: [...], &#34;transforms&#34;: [...], &#34;writers&#34;: [...] }
        &#34;&#34;&#34;
        raise NotImplementedError(&#39;get_logger_config must be implemented by subclass&#39;)

    #############################
    def get_logger_configs(self, mode=None):
        &#34;&#34;&#34;Retrieve the configs associated with a mode from the data store.
        If mode is omitted, retrieve configs associated with the active mode.
        &gt; api.get_logger_configs()
               {&#34;knud&#34;: { config_spec },
                &#34;gyr1&#34;: { config_spec }
               }
        &#34;&#34;&#34;
        raise NotImplementedError(&#39;get_logger_configs must be implemented by subclass&#39;)

    #############################
    def get_logger_config_name(self, logger_id, mode=None):
        &#34;&#34;&#34;Retrieve the name of the logger config associated with the
        specified logger in the specified mode. If mode is omitted,
        retrieve config name associated with the active mode.
        &gt; api.get_logger_config_name(&#39;knud&#39;)
            knud-&gt;net
       &#34;&#34;&#34;
        raise NotImplementedError(
            &#39;get_logger_config_name must be implemented by subclass&#39;)

    #############################
    def get_logger_config_names(self, logger_id):
        &#34;&#34;&#34;Retrieve list of logger config names for the specified logger.
        &gt; api.get_logger_config_names(&#39;knud&#39;)
            [&#34;off&#34;, &#34;knud-&gt;net&#34;, &#34;knud-&gt;net/file&#34;, &#34;knud-&gt;net/file/db&#34;]
        &#34;&#34;&#34;
        raise NotImplementedError(
            &#39;get_logger_config_names must be implemented by subclass&#39;)

    ############################
    # Methods for manipulating the desired state via API to indicate
    # current mode and which loggers should be in which configs.
    #
    # These are triggered from the user/API/web interface
    ############################
    def set_active_mode(self, mode):
        &#34;&#34;&#34;Set the active mode for OpenRVDAS.
        &gt; api.set_active_mode(port&#39;)
        &#34;&#34;&#34;
        raise NotImplementedError(&#39;set_active_mode must be implemented by subclass&#39;)

    #############################
    def set_active_logger_config(self, logger, config_name):
        &#34;&#34;&#34;Set the active logger config for the specified logger to
        the specific logger_config name.
        &gt; api.set_active_logger_config(&#39;knud&#39;, &#39;knud-&gt;file/net/db&#39;)
        &#34;&#34;&#34;
        raise NotImplementedError(
            &#39;set_active_logger_config must be implemented by subclass&#39;)

    #############################

    def quit(self):
        &#34;&#34;&#34;Execute any callbacks that were registered to run on quit.&#34;&#34;&#34;
        for (callback, kwargs) in self.quit_callbacks:
            logging.debug(&#39;Executing quit callback: %s&#39;, callback)
            callback(**kwargs)

    #############################
    # API method to register a callback. When the data store changes,
    # methods that are registered via on_update() will be called so they
    # can fetch updated results.
    #############################
    def on_update(self, callback, kwargs=None):
        &#34;&#34;&#34;Register a method to be called when current configs change.&#34;&#34;&#34;
        if kwargs is None:
            kwargs = {}
        self.update_callbacks.append((callback, kwargs))

    #############################
    def signal_update(self):
        &#34;&#34;&#34;Call the registered methods when current configs change.&#34;&#34;&#34;
        for (callback, kwargs) in self.update_callbacks:
            logging.debug(&#39;Executing update callback: %s&#39;, callback)
            callback(**kwargs)

    #############################
    # API method to register a callback. When the data store changes,
    # methods that are registered via on_update() will be called so they
    # can fetch updated results.
    #############################
    def on_load(self, callback, kwargs=None):
        &#34;&#34;&#34;Register a method to be called when new configs have been loaded.&#34;&#34;&#34;
        if kwargs is None:
            kwargs = {}
        self.load_callbacks.append((callback, kwargs))

    #############################
    def signal_load(self):
        &#34;&#34;&#34;Call the registered methods when new configs have been loaded.&#34;&#34;&#34;
        for (callback, kwargs) in self.load_callbacks:
            logging.debug(&#39;Executing load callback: %s&#39;, callback)
            callback(**kwargs)

    #############################
    # API method to register a callback. When the data store changes,
    # methods that are registered via on_update() will be called so they
    # can fetch updated results.
    #############################
    def on_quit(self, callback, kwargs=None):
        &#34;&#34;&#34;Register a method to be called when quit is signaled changes.&#34;&#34;&#34;
        if kwargs is None:
            kwargs = {}
        self.quit_callbacks.append((callback, kwargs))

    ############################
    # Methods for getting logger status data from API
    ############################
    def get_status(self, since_timestamp=None):
        &#34;&#34;&#34;Retrieve a dict of the most-recent status report from each
        logger. If since_timestamp is specified, retrieve all status reports
        since that time.&#34;&#34;&#34;
        raise NotImplementedError(&#39;get_status must be implemented by subclass&#39;)

    ############################
    # Methods for storing/retrieving messages from servers/loggers/etc.
    ############################
    # Logging levels corresponding to logging module levels
    CRITICAL = logging.CRITICAL
    ERROR = logging.ERROR
    WARNING = logging.WARNING
    INFO = logging.INFO
    DEBUG = logging.DEBUG

    ############################
    def message_log(self, source, user, log_level, message):
        &#34;&#34;&#34;Timestamp and store the passed message.&#34;&#34;&#34;
        raise NotImplementedError(&#39;message_log must be implemented by subclass&#39;)

    ############################
    def get_message_log(self, source=None, user=None, log_level=sys.maxsize,
                        since_timestamp=None):
        &#34;&#34;&#34;Retrieve log messages from source at or above log_level since
        timestamp. If source is omitted, retrieve from all sources. If
        log_level is omitted, retrieve at all levels. If since_timestamp is
        omitted, only retrieve most recent message.
        &#34;&#34;&#34;
        raise NotImplementedError(&#39;get_message_log must be implemented by subclass&#39;)

    #############################
    &#34;&#34;&#34;Methods below are used to load/create/modify the data store&#39;s model
  of a cruise.&#34;&#34;&#34;
    #############################

    def load_configuration(self, configuration):
        &#34;&#34;&#34;Load a complete cruise configuration to the data store.
        &gt; api.load_configuration({ configuration })
        &#34;&#34;&#34;
        raise NotImplementedError(&#39;load_configuration must be implemented by subclass&#39;)

    #############################
    # def add_cruise(self, cruise_id, start=None, end=None):
    #   &#34;&#34;&#34;Add a new cruise_id to the data store. Use methods below to build
    #   it out.
    #   &gt; api.add_cruise(&#39;NBP1702&#39;, &#39;2017-02-02&#39;, &#39;2017-03-01&#39;)
    #   &#34;&#34;&#34;
    #   raise NotImplementedError(&#39;add_cruise must be implemented by subclass&#39;)

    #############################
    def delete_configuration(self):
        &#34;&#34;&#34;Remove the specified cruise from the data store.
        &gt; api.delete_configuration()
        &#34;&#34;&#34;
        raise NotImplementedError(&#39;delete_configuration must be implemented by subclass&#39;)

    #############################
    def add_mode(self, mode):
        &#34;&#34;&#34;Add a new mode to the OpenRVDAS configuration.
        &gt; api.add_mode(&#39;underway&#39;)
        &#34;&#34;&#34;
        raise NotImplementedError(&#39;add_mode must be implemented by subclass&#39;)

    #############################
    def delete_mode(self, mode):
        &#34;&#34;&#34;Delete the named mode (and all its configs) from the
        data store. If the deleted mode is the active mode, set
        the active mode to the default mode.
        &gt; api.delete_mode(&#39;underway&#39;)
        &#34;&#34;&#34;
        raise NotImplementedError(&#39;delete_mode must be implemented by subclass&#39;)

    #############################
    def add_logger(self, logger_id, logger_config):
        &#34;&#34;&#34;Add a new logger to the data store.

        logger_config - a dict defining:
          host - optional restriction on which host logger must run
          configs - list of logger_config names
        &gt; api.add_logger(gyr2&#39;, { &#39;host_id&#39;: &lt;host_id&gt;, &#39;configs&#39;: [....] })
        &#34;&#34;&#34;
        raise NotImplementedError(&#39;add_logger must be implemented by subclass&#39;)

    #############################
    def delete_logger(self, logger_id):
        &#34;&#34;&#34;Remove a logger and all its associated logger_configs from the data store.
        &gt; api.delete_logger(gyr2&#39;)
        &#34;&#34;&#34;
        raise NotImplementedError(&#39;delete_logger must be implemented by subclass&#39;)

    #############################
    def add_logger_config(self, logger_config_name, logger_config_spec):
        &#34;&#34;&#34;Add a new logger config to the data store.
        &gt; api.add_logger_config(&#39;gyr2-&gt;net/file/db&#39;, { logger_config_spec })
        &#34;&#34;&#34;
        raise NotImplementedError(&#39;add_config must be implemented by subclass&#39;)

    #############################
    def add_logger_config_to_logger(self, config, logger_id):
        &#34;&#34;&#34;Associate a config with a logger.
        &gt; api.add_logger_config_to_logger(&#39;gyr2-&gt;net/file/db&#39;, &#39;gyr2&#39;)
        &#34;&#34;&#34;
        raise NotImplementedError(&#39;add_logger_config_to_logger must be implemented by subclass&#39;)

    #############################
    def add_logger_config_to_mode(self, config, logger_id, mode):
        &#34;&#34;&#34;Associate a config with a logger and mode.
        &gt; api.add_logger_config_to_mode(&#39;gyr2-&gt;net/file/db&#39;, &#39;gyr2&#39;, &#39;underway&#39;)
        &#34;&#34;&#34;
        raise NotImplementedError(&#39;add_logger_config_to_mode must be implemented by subclass&#39;)

    #############################
    def delete_logger_config(self, config_id):
        &#34;&#34;&#34;Delete specified config from data store (and by extension,
        from the mode and logger with which it is associated.
        &gt; api.delete_logger_config(&#39;gyr2-&gt;net/file/db&#39;)
        &#34;&#34;&#34;
        raise NotImplementedError(&#39;delete_logger_config must be implemented by subclass&#39;)</code></pre>
</details>
</section>
<section>
</section>
<section>
</section>
<section>
</section>
<section>
<h2 class="section-title" id="header-classes">Classes</h2>
<dl>
<dt id="server.server_api.ServerAPI"><code class="flex name class">
<span>class <span class="ident">ServerAPI</span></span>
</code></dt>
<dd>
<div class="desc"><p>Abstract base class defining an API through which a LoggerServer
can interact with a data store.</p>
<p>Parameters below have the following semantics:</p>
<pre><code>configuration - dict definition of a OpenRVDAS configuration
mode          - dict name of mode, and logger_config_names associated with that mode
default_mode  - name of mode to use at startup or when returning to a default state

logger_config_name - string name of a logger configuration, unique within configration
logger_config - dict definition of a logger configuration

logger_id     - string name of logger, unique within cruise
logger        - dict definition of logger, including list of names of
                valid configs and optional host restriction

logger_configs - dict of {logger_config_name:logger_config,...}
</code></pre>
<p>For the purposes of documentation below, assume a sample
cruise_config as follows:</p>
<pre><code>{
  &quot;loggers&quot;: {
    &quot;knud&quot;: {
      &quot;host&quot;: &quot;knud.pi&quot;,
      &quot;configs&quot;: [&quot;off&quot;, &quot;knud-&gt;net&quot;, &quot;knud-&gt;file/net/db&quot;]
    },
    &quot;gyr1&quot;: {
      &quot;configs&quot;: [&quot;off&quot;, &quot;gyr1-&gt;net&quot;, &quot;gyr1-&gt;file/net/db&quot;]
    },
  &quot;modes&quot;: {
    &quot;off&quot;: {&quot;knud&quot;: &quot;off&quot;, &quot;gyr1&quot;: &quot;off&quot;},
    &quot;port&quot;: {&quot;knud&quot;: &quot;off&quot;, &quot;gyr1&quot;: &quot;gyr1-&gt;net&quot;},
    &quot;underway&quot;: { &quot;knud&quot;: &quot;knud-&gt;file/net/db&quot;,
                  &quot;gyr1&quot;: &quot;gyr1-&gt;file/net/db&quot;
                }
  },
  &quot;default_mode&quot;: &quot;off&quot;,
  &quot;configs&quot;: {
    &quot;off&quot;: {},
    &quot;knud-&gt;net&quot;: { config_spec },
    &quot;knud-&gt;file/net/db&quot;: { config_spec },
    &quot;gyr1-&gt;net&quot;: { config_spec },
    &quot;gyr1-&gt;file/net/dbnet&quot;: { config_spec }
  }
}
</code></pre></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">class ServerAPI:
    &#34;&#34;&#34;Abstract base class defining an API through which a LoggerServer
    can interact with a data store.

    Parameters below have the following semantics:
    ```
    configuration - dict definition of a OpenRVDAS configuration
    mode          - dict name of mode, and logger_config_names associated with that mode
    default_mode  - name of mode to use at startup or when returning to a default state

    logger_config_name - string name of a logger configuration, unique within configration
    logger_config - dict definition of a logger configuration

    logger_id     - string name of logger, unique within cruise
    logger        - dict definition of logger, including list of names of
                    valid configs and optional host restriction

    logger_configs - dict of {logger_config_name:logger_config,...}
    ```
    For the purposes of documentation below, assume a sample
    cruise_config as follows:
    ```
    {
      &#34;loggers&#34;: {
        &#34;knud&#34;: {
          &#34;host&#34;: &#34;knud.pi&#34;,
          &#34;configs&#34;: [&#34;off&#34;, &#34;knud-&gt;net&#34;, &#34;knud-&gt;file/net/db&#34;]
        },
        &#34;gyr1&#34;: {
          &#34;configs&#34;: [&#34;off&#34;, &#34;gyr1-&gt;net&#34;, &#34;gyr1-&gt;file/net/db&#34;]
        },
      &#34;modes&#34;: {
        &#34;off&#34;: {&#34;knud&#34;: &#34;off&#34;, &#34;gyr1&#34;: &#34;off&#34;},
        &#34;port&#34;: {&#34;knud&#34;: &#34;off&#34;, &#34;gyr1&#34;: &#34;gyr1-&gt;net&#34;},
        &#34;underway&#34;: { &#34;knud&#34;: &#34;knud-&gt;file/net/db&#34;,
                      &#34;gyr1&#34;: &#34;gyr1-&gt;file/net/db&#34;
                    }
      },
      &#34;default_mode&#34;: &#34;off&#34;,
      &#34;configs&#34;: {
        &#34;off&#34;: {},
        &#34;knud-&gt;net&#34;: { config_spec },
        &#34;knud-&gt;file/net/db&#34;: { config_spec },
        &#34;gyr1-&gt;net&#34;: { config_spec },
        &#34;gyr1-&gt;file/net/dbnet&#34;: { config_spec }
      }
    }
    ```
    &#34;&#34;&#34;

    ############################
    def __init__(self):
        # Called when we update which configs are active.
        self.update_callbacks = []

        # Called when the set of configs changes.
        self.load_callbacks = []

        # Called, obviously, when &#39;quit&#39; is signalled.
        self.quit_callbacks = []

    #############################
    # API methods below are used in querying/modifying the API for the
    # record of the running state of loggers.
    #############################
    # def get_cruises(self):
    #   &#34;&#34;&#34;Return list of cruise id&#39;s. Returns, e.g.
    #   &gt; api.get_cruises()
    #       [&#34;NBP1700&#34;, &#34;NBP1701&#34;]
    #   &#34;&#34;&#34;
    #   raise NotImplementedError(&#39;get_cruises must be implemented by subclass&#39;)

    #############################
    def get_configuration(self):
        &#34;&#34;&#34;Get OpenRVDAS configuration from the data store.
        &#34;&#34;&#34;
        raise NotImplementedError(&#39;get_configuration must be implemented by subclass&#39;)

    #############################
    def get_modes(self):
        &#34;&#34;&#34;Get the list of modes from the data store.
        &gt; api.get_modes()
            [&#34;off&#34;, &#34;port&#34;, &#34;underway&#34;]
        &#34;&#34;&#34;
        raise NotImplementedError(&#39;get_modes must be implemented by subclass&#39;)

    #############################
    def get_active_mode(self):
        &#34;&#34;&#34;Get the currently active mode from the data store.
        &gt; api.get_active_mode()
            &#34;port&#34;
        &#34;&#34;&#34;
        raise NotImplementedError(&#39;get_active_mode must be implemented by subclass&#39;)

    #############################
    def get_default_mode(self):
        &#34;&#34;&#34;Get the default mode from the data store.
        &gt; api.get_default_mode()
            &#34;off&#34;
        &#34;&#34;&#34;
        raise NotImplementedError(&#39;get_default_mode must be implemented by subclass&#39;)

    #############################
    def get_loggers(self):
        &#34;&#34;&#34;Get the dict of {logger_id:logger_spec,...} from the data store.
        &gt; api.get_loggers()
            {
              &#34;knud&#34;: {&#34;host&#34;: &#34;knud.pi&#34;, &#34;configs&#34;:...},
              &#34;gyr1&#34;: {&#34;configs&#34;:...}
            }
        &#34;&#34;&#34;
        raise NotImplementedError(&#39;get_loggers must be implemented by subclass&#39;)

    #############################
    def get_logger(self, logger_id):
        &#34;&#34;&#34;Retrieve the logger spec for the specified logger id.
        &gt; api.get_logger(&#39;knud&#39;)
            {&#34;name&#34;: &#34;knud-&gt;net&#34;, &#34;host_id&#34;: &#34;knud.pi&#34;, &#34;configs&#34;:...}
        &#34;&#34;&#34;
        raise NotImplementedError(&#39;get_logger must be implemented by subclass&#39;)

    #############################
    def get_logger_config(self, config_name):
        &#34;&#34;&#34;Retrieve the logger config associated with the specified name.
        &gt; api.get_logger_config(&#39;knud-&gt;net&#39;)
               { &#34;readers&#34;: [...], &#34;transforms&#34;: [...], &#34;writers&#34;: [...] }
        &#34;&#34;&#34;
        raise NotImplementedError(&#39;get_logger_config must be implemented by subclass&#39;)

    #############################
    def get_logger_configs(self, mode=None):
        &#34;&#34;&#34;Retrieve the configs associated with a mode from the data store.
        If mode is omitted, retrieve configs associated with the active mode.
        &gt; api.get_logger_configs()
               {&#34;knud&#34;: { config_spec },
                &#34;gyr1&#34;: { config_spec }
               }
        &#34;&#34;&#34;
        raise NotImplementedError(&#39;get_logger_configs must be implemented by subclass&#39;)

    #############################
    def get_logger_config_name(self, logger_id, mode=None):
        &#34;&#34;&#34;Retrieve the name of the logger config associated with the
        specified logger in the specified mode. If mode is omitted,
        retrieve config name associated with the active mode.
        &gt; api.get_logger_config_name(&#39;knud&#39;)
            knud-&gt;net
       &#34;&#34;&#34;
        raise NotImplementedError(
            &#39;get_logger_config_name must be implemented by subclass&#39;)

    #############################
    def get_logger_config_names(self, logger_id):
        &#34;&#34;&#34;Retrieve list of logger config names for the specified logger.
        &gt; api.get_logger_config_names(&#39;knud&#39;)
            [&#34;off&#34;, &#34;knud-&gt;net&#34;, &#34;knud-&gt;net/file&#34;, &#34;knud-&gt;net/file/db&#34;]
        &#34;&#34;&#34;
        raise NotImplementedError(
            &#39;get_logger_config_names must be implemented by subclass&#39;)

    ############################
    # Methods for manipulating the desired state via API to indicate
    # current mode and which loggers should be in which configs.
    #
    # These are triggered from the user/API/web interface
    ############################
    def set_active_mode(self, mode):
        &#34;&#34;&#34;Set the active mode for OpenRVDAS.
        &gt; api.set_active_mode(port&#39;)
        &#34;&#34;&#34;
        raise NotImplementedError(&#39;set_active_mode must be implemented by subclass&#39;)

    #############################
    def set_active_logger_config(self, logger, config_name):
        &#34;&#34;&#34;Set the active logger config for the specified logger to
        the specific logger_config name.
        &gt; api.set_active_logger_config(&#39;knud&#39;, &#39;knud-&gt;file/net/db&#39;)
        &#34;&#34;&#34;
        raise NotImplementedError(
            &#39;set_active_logger_config must be implemented by subclass&#39;)

    #############################

    def quit(self):
        &#34;&#34;&#34;Execute any callbacks that were registered to run on quit.&#34;&#34;&#34;
        for (callback, kwargs) in self.quit_callbacks:
            logging.debug(&#39;Executing quit callback: %s&#39;, callback)
            callback(**kwargs)

    #############################
    # API method to register a callback. When the data store changes,
    # methods that are registered via on_update() will be called so they
    # can fetch updated results.
    #############################
    def on_update(self, callback, kwargs=None):
        &#34;&#34;&#34;Register a method to be called when current configs change.&#34;&#34;&#34;
        if kwargs is None:
            kwargs = {}
        self.update_callbacks.append((callback, kwargs))

    #############################
    def signal_update(self):
        &#34;&#34;&#34;Call the registered methods when current configs change.&#34;&#34;&#34;
        for (callback, kwargs) in self.update_callbacks:
            logging.debug(&#39;Executing update callback: %s&#39;, callback)
            callback(**kwargs)

    #############################
    # API method to register a callback. When the data store changes,
    # methods that are registered via on_update() will be called so they
    # can fetch updated results.
    #############################
    def on_load(self, callback, kwargs=None):
        &#34;&#34;&#34;Register a method to be called when new configs have been loaded.&#34;&#34;&#34;
        if kwargs is None:
            kwargs = {}
        self.load_callbacks.append((callback, kwargs))

    #############################
    def signal_load(self):
        &#34;&#34;&#34;Call the registered methods when new configs have been loaded.&#34;&#34;&#34;
        for (callback, kwargs) in self.load_callbacks:
            logging.debug(&#39;Executing load callback: %s&#39;, callback)
            callback(**kwargs)

    #############################
    # API method to register a callback. When the data store changes,
    # methods that are registered via on_update() will be called so they
    # can fetch updated results.
    #############################
    def on_quit(self, callback, kwargs=None):
        &#34;&#34;&#34;Register a method to be called when quit is signaled changes.&#34;&#34;&#34;
        if kwargs is None:
            kwargs = {}
        self.quit_callbacks.append((callback, kwargs))

    ############################
    # Methods for getting logger status data from API
    ############################
    def get_status(self, since_timestamp=None):
        &#34;&#34;&#34;Retrieve a dict of the most-recent status report from each
        logger. If since_timestamp is specified, retrieve all status reports
        since that time.&#34;&#34;&#34;
        raise NotImplementedError(&#39;get_status must be implemented by subclass&#39;)

    ############################
    # Methods for storing/retrieving messages from servers/loggers/etc.
    ############################
    # Logging levels corresponding to logging module levels
    CRITICAL = logging.CRITICAL
    ERROR = logging.ERROR
    WARNING = logging.WARNING
    INFO = logging.INFO
    DEBUG = logging.DEBUG

    ############################
    def message_log(self, source, user, log_level, message):
        &#34;&#34;&#34;Timestamp and store the passed message.&#34;&#34;&#34;
        raise NotImplementedError(&#39;message_log must be implemented by subclass&#39;)

    ############################
    def get_message_log(self, source=None, user=None, log_level=sys.maxsize,
                        since_timestamp=None):
        &#34;&#34;&#34;Retrieve log messages from source at or above log_level since
        timestamp. If source is omitted, retrieve from all sources. If
        log_level is omitted, retrieve at all levels. If since_timestamp is
        omitted, only retrieve most recent message.
        &#34;&#34;&#34;
        raise NotImplementedError(&#39;get_message_log must be implemented by subclass&#39;)

    #############################
    &#34;&#34;&#34;Methods below are used to load/create/modify the data store&#39;s model
  of a cruise.&#34;&#34;&#34;
    #############################

    def load_configuration(self, configuration):
        &#34;&#34;&#34;Load a complete cruise configuration to the data store.
        &gt; api.load_configuration({ configuration })
        &#34;&#34;&#34;
        raise NotImplementedError(&#39;load_configuration must be implemented by subclass&#39;)

    #############################
    # def add_cruise(self, cruise_id, start=None, end=None):
    #   &#34;&#34;&#34;Add a new cruise_id to the data store. Use methods below to build
    #   it out.
    #   &gt; api.add_cruise(&#39;NBP1702&#39;, &#39;2017-02-02&#39;, &#39;2017-03-01&#39;)
    #   &#34;&#34;&#34;
    #   raise NotImplementedError(&#39;add_cruise must be implemented by subclass&#39;)

    #############################
    def delete_configuration(self):
        &#34;&#34;&#34;Remove the specified cruise from the data store.
        &gt; api.delete_configuration()
        &#34;&#34;&#34;
        raise NotImplementedError(&#39;delete_configuration must be implemented by subclass&#39;)

    #############################
    def add_mode(self, mode):
        &#34;&#34;&#34;Add a new mode to the OpenRVDAS configuration.
        &gt; api.add_mode(&#39;underway&#39;)
        &#34;&#34;&#34;
        raise NotImplementedError(&#39;add_mode must be implemented by subclass&#39;)

    #############################
    def delete_mode(self, mode):
        &#34;&#34;&#34;Delete the named mode (and all its configs) from the
        data store. If the deleted mode is the active mode, set
        the active mode to the default mode.
        &gt; api.delete_mode(&#39;underway&#39;)
        &#34;&#34;&#34;
        raise NotImplementedError(&#39;delete_mode must be implemented by subclass&#39;)

    #############################
    def add_logger(self, logger_id, logger_config):
        &#34;&#34;&#34;Add a new logger to the data store.

        logger_config - a dict defining:
          host - optional restriction on which host logger must run
          configs - list of logger_config names
        &gt; api.add_logger(gyr2&#39;, { &#39;host_id&#39;: &lt;host_id&gt;, &#39;configs&#39;: [....] })
        &#34;&#34;&#34;
        raise NotImplementedError(&#39;add_logger must be implemented by subclass&#39;)

    #############################
    def delete_logger(self, logger_id):
        &#34;&#34;&#34;Remove a logger and all its associated logger_configs from the data store.
        &gt; api.delete_logger(gyr2&#39;)
        &#34;&#34;&#34;
        raise NotImplementedError(&#39;delete_logger must be implemented by subclass&#39;)

    #############################
    def add_logger_config(self, logger_config_name, logger_config_spec):
        &#34;&#34;&#34;Add a new logger config to the data store.
        &gt; api.add_logger_config(&#39;gyr2-&gt;net/file/db&#39;, { logger_config_spec })
        &#34;&#34;&#34;
        raise NotImplementedError(&#39;add_config must be implemented by subclass&#39;)

    #############################
    def add_logger_config_to_logger(self, config, logger_id):
        &#34;&#34;&#34;Associate a config with a logger.
        &gt; api.add_logger_config_to_logger(&#39;gyr2-&gt;net/file/db&#39;, &#39;gyr2&#39;)
        &#34;&#34;&#34;
        raise NotImplementedError(&#39;add_logger_config_to_logger must be implemented by subclass&#39;)

    #############################
    def add_logger_config_to_mode(self, config, logger_id, mode):
        &#34;&#34;&#34;Associate a config with a logger and mode.
        &gt; api.add_logger_config_to_mode(&#39;gyr2-&gt;net/file/db&#39;, &#39;gyr2&#39;, &#39;underway&#39;)
        &#34;&#34;&#34;
        raise NotImplementedError(&#39;add_logger_config_to_mode must be implemented by subclass&#39;)

    #############################
    def delete_logger_config(self, config_id):
        &#34;&#34;&#34;Delete specified config from data store (and by extension,
        from the mode and logger with which it is associated.
        &gt; api.delete_logger_config(&#39;gyr2-&gt;net/file/db&#39;)
        &#34;&#34;&#34;
        raise NotImplementedError(&#39;delete_logger_config must be implemented by subclass&#39;)</code></pre>
</details>
<h3>Subclasses</h3>
<ul class="hlist">
<li><a title="server.in_memory_server_api.InMemoryServerAPI" href="in_memory_server_api.html#server.in_memory_server_api.InMemoryServerAPI">InMemoryServerAPI</a></li>
<li><a title="server.sqlite_server_api.SQLiteServerAPI" href="sqlite_server_api.html#server.sqlite_server_api.SQLiteServerAPI">SQLiteServerAPI</a></li>
</ul>
<h3>Class variables</h3>
<dl>
<dt id="server.server_api.ServerAPI.CRITICAL"><code class="name">var <span class="ident">CRITICAL</span></code></dt>
<dd>
<div class="desc"></div>
</dd>
<dt id="server.server_api.ServerAPI.DEBUG"><code class="name">var <span class="ident">DEBUG</span></code></dt>
<dd>
<div class="desc"></div>
</dd>
<dt id="server.server_api.ServerAPI.ERROR"><code class="name">var <span class="ident">ERROR</span></code></dt>
<dd>
<div class="desc"></div>
</dd>
<dt id="server.server_api.ServerAPI.INFO"><code class="name">var <span class="ident">INFO</span></code></dt>
<dd>
<div class="desc"></div>
</dd>
<dt id="server.server_api.ServerAPI.WARNING"><code class="name">var <span class="ident">WARNING</span></code></dt>
<dd>
<div class="desc"></div>
</dd>
</dl>
<h3>Methods</h3>
<dl>
<dt id="server.server_api.ServerAPI.add_logger"><code class="name flex">
<span>def <span class="ident">add_logger</span></span>(<span>self, logger_id, logger_config)</span>
</code></dt>
<dd>
<div class="desc"><p>Add a new logger to the data store.</p>
<p>logger_config - a dict defining:
host - optional restriction on which host logger must run
configs - list of logger_config names</p>
<blockquote>
<p>api.add_logger(gyr2', { 'host_id': <host_id>, 'configs': [....] })</p>
</blockquote></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def add_logger(self, logger_id, logger_config):
    &#34;&#34;&#34;Add a new logger to the data store.

    logger_config - a dict defining:
      host - optional restriction on which host logger must run
      configs - list of logger_config names
    &gt; api.add_logger(gyr2&#39;, { &#39;host_id&#39;: &lt;host_id&gt;, &#39;configs&#39;: [....] })
    &#34;&#34;&#34;
    raise NotImplementedError(&#39;add_logger must be implemented by subclass&#39;)</code></pre>
</details>
</dd>
<dt id="server.server_api.ServerAPI.add_logger_config"><code class="name flex">
<span>def <span class="ident">add_logger_config</span></span>(<span>self, logger_config_name, logger_config_spec)</span>
</code></dt>
<dd>
<div class="desc"><p>Add a new logger config to the data store.</p>
<blockquote>
<p>api.add_logger_config('gyr2-&gt;net/file/db', { logger_config_spec })</p>
</blockquote></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def add_logger_config(self, logger_config_name, logger_config_spec):
    &#34;&#34;&#34;Add a new logger config to the data store.
    &gt; api.add_logger_config(&#39;gyr2-&gt;net/file/db&#39;, { logger_config_spec })
    &#34;&#34;&#34;
    raise NotImplementedError(&#39;add_config must be implemented by subclass&#39;)</code></pre>
</details>
</dd>
<dt id="server.server_api.ServerAPI.add_logger_config_to_logger"><code class="name flex">
<span>def <span class="ident">add_logger_config_to_logger</span></span>(<span>self, config, logger_id)</span>
</code></dt>
<dd>
<div class="desc"><p>Associate a config with a logger.</p>
<blockquote>
<p>api.add_logger_config_to_logger('gyr2-&gt;net/file/db', 'gyr2')</p>
</blockquote></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def add_logger_config_to_logger(self, config, logger_id):
    &#34;&#34;&#34;Associate a config with a logger.
    &gt; api.add_logger_config_to_logger(&#39;gyr2-&gt;net/file/db&#39;, &#39;gyr2&#39;)
    &#34;&#34;&#34;
    raise NotImplementedError(&#39;add_logger_config_to_logger must be implemented by subclass&#39;)</code></pre>
</details>
</dd>
<dt id="server.server_api.ServerAPI.add_logger_config_to_mode"><code class="name flex">
<span>def <span class="ident">add_logger_config_to_mode</span></span>(<span>self, config, logger_id, mode)</span>
</code></dt>
<dd>
<div class="desc"><p>Associate a config with a logger and mode.</p>
<blockquote>
<p>api.add_logger_config_to_mode('gyr2-&gt;net/file/db', 'gyr2', 'underway')</p>
</blockquote></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def add_logger_config_to_mode(self, config, logger_id, mode):
    &#34;&#34;&#34;Associate a config with a logger and mode.
    &gt; api.add_logger_config_to_mode(&#39;gyr2-&gt;net/file/db&#39;, &#39;gyr2&#39;, &#39;underway&#39;)
    &#34;&#34;&#34;
    raise NotImplementedError(&#39;add_logger_config_to_mode must be implemented by subclass&#39;)</code></pre>
</details>
</dd>
<dt id="server.server_api.ServerAPI.add_mode"><code class="name flex">
<span>def <span class="ident">add_mode</span></span>(<span>self, mode)</span>
</code></dt>
<dd>
<div class="desc"><p>Add a new mode to the OpenRVDAS configuration.</p>
<blockquote>
<p>api.add_mode('underway')</p>
</blockquote></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def add_mode(self, mode):
    &#34;&#34;&#34;Add a new mode to the OpenRVDAS configuration.
    &gt; api.add_mode(&#39;underway&#39;)
    &#34;&#34;&#34;
    raise NotImplementedError(&#39;add_mode must be implemented by subclass&#39;)</code></pre>
</details>
</dd>
<dt id="server.server_api.ServerAPI.delete_configuration"><code class="name flex">
<span>def <span class="ident">delete_configuration</span></span>(<span>self)</span>
</code></dt>
<dd>
<div class="desc"><p>Remove the specified cruise from the data store.</p>
<blockquote>
<p>api.delete_configuration()</p>
</blockquote></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def delete_configuration(self):
    &#34;&#34;&#34;Remove the specified cruise from the data store.
    &gt; api.delete_configuration()
    &#34;&#34;&#34;
    raise NotImplementedError(&#39;delete_configuration must be implemented by subclass&#39;)</code></pre>
</details>
</dd>
<dt id="server.server_api.ServerAPI.delete_logger"><code class="name flex">
<span>def <span class="ident">delete_logger</span></span>(<span>self, logger_id)</span>
</code></dt>
<dd>
<div class="desc"><p>Remove a logger and all its associated logger_configs from the data store.</p>
<blockquote>
<p>api.delete_logger(gyr2')</p>
</blockquote></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def delete_logger(self, logger_id):
    &#34;&#34;&#34;Remove a logger and all its associated logger_configs from the data store.
    &gt; api.delete_logger(gyr2&#39;)
    &#34;&#34;&#34;
    raise NotImplementedError(&#39;delete_logger must be implemented by subclass&#39;)</code></pre>
</details>
</dd>
<dt id="server.server_api.ServerAPI.delete_logger_config"><code class="name flex">
<span>def <span class="ident">delete_logger_config</span></span>(<span>self, config_id)</span>
</code></dt>
<dd>
<div class="desc"><p>Delete specified config from data store (and by extension,
from the mode and logger with which it is associated.</p>
<blockquote>
<p>api.delete_logger_config('gyr2-&gt;net/file/db')</p>
</blockquote></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def delete_logger_config(self, config_id):
    &#34;&#34;&#34;Delete specified config from data store (and by extension,
    from the mode and logger with which it is associated.
    &gt; api.delete_logger_config(&#39;gyr2-&gt;net/file/db&#39;)
    &#34;&#34;&#34;
    raise NotImplementedError(&#39;delete_logger_config must be implemented by subclass&#39;)</code></pre>
</details>
</dd>
<dt id="server.server_api.ServerAPI.delete_mode"><code class="name flex">
<span>def <span class="ident">delete_mode</span></span>(<span>self, mode)</span>
</code></dt>
<dd>
<div class="desc"><p>Delete the named mode (and all its configs) from the
data store. If the deleted mode is the active mode, set
the active mode to the default mode.</p>
<blockquote>
<p>api.delete_mode('underway')</p>
</blockquote></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def delete_mode(self, mode):
    &#34;&#34;&#34;Delete the named mode (and all its configs) from the
    data store. If the deleted mode is the active mode, set
    the active mode to the default mode.
    &gt; api.delete_mode(&#39;underway&#39;)
    &#34;&#34;&#34;
    raise NotImplementedError(&#39;delete_mode must be implemented by subclass&#39;)</code></pre>
</details>
</dd>
<dt id="server.server_api.ServerAPI.get_active_mode"><code class="name flex">
<span>def <span class="ident">get_active_mode</span></span>(<span>self)</span>
</code></dt>
<dd>
<div class="desc"><p>Get the currently active mode from the data store.</p>
<blockquote>
<p>api.get_active_mode()
"port"</p>
</blockquote></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def get_active_mode(self):
    &#34;&#34;&#34;Get the currently active mode from the data store.
    &gt; api.get_active_mode()
        &#34;port&#34;
    &#34;&#34;&#34;
    raise NotImplementedError(&#39;get_active_mode must be implemented by subclass&#39;)</code></pre>
</details>
</dd>
<dt id="server.server_api.ServerAPI.get_configuration"><code class="name flex">
<span>def <span class="ident">get_configuration</span></span>(<span>self)</span>
</code></dt>
<dd>
<div class="desc"><p>Get OpenRVDAS configuration from the data store.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def get_configuration(self):
    &#34;&#34;&#34;Get OpenRVDAS configuration from the data store.
    &#34;&#34;&#34;
    raise NotImplementedError(&#39;get_configuration must be implemented by subclass&#39;)</code></pre>
</details>
</dd>
<dt id="server.server_api.ServerAPI.get_default_mode"><code class="name flex">
<span>def <span class="ident">get_default_mode</span></span>(<span>self)</span>
</code></dt>
<dd>
<div class="desc"><p>Get the default mode from the data store.</p>
<blockquote>
<p>api.get_default_mode()
"off"</p>
</blockquote></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def get_default_mode(self):
    &#34;&#34;&#34;Get the default mode from the data store.
    &gt; api.get_default_mode()
        &#34;off&#34;
    &#34;&#34;&#34;
    raise NotImplementedError(&#39;get_default_mode must be implemented by subclass&#39;)</code></pre>
</details>
</dd>
<dt id="server.server_api.ServerAPI.get_logger"><code class="name flex">
<span>def <span class="ident">get_logger</span></span>(<span>self, logger_id)</span>
</code></dt>
<dd>
<div class="desc"><p>Retrieve the logger spec for the specified logger id.</p>
<blockquote>
<p _configs_:...="&quot;configs&quot;:..." _host_id_:="&quot;host_id&quot;:" _knud-_net_="&quot;knud-&gt;net&quot;," _knud.pi_="&quot;knud.pi&quot;," _name_:="&quot;name&quot;:">api.get_logger('knud')</p>
</blockquote></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def get_logger(self, logger_id):
    &#34;&#34;&#34;Retrieve the logger spec for the specified logger id.
    &gt; api.get_logger(&#39;knud&#39;)
        {&#34;name&#34;: &#34;knud-&gt;net&#34;, &#34;host_id&#34;: &#34;knud.pi&#34;, &#34;configs&#34;:...}
    &#34;&#34;&#34;
    raise NotImplementedError(&#39;get_logger must be implemented by subclass&#39;)</code></pre>
</details>
</dd>
<dt id="server.server_api.ServerAPI.get_logger_config"><code class="name flex">
<span>def <span class="ident">get_logger_config</span></span>(<span>self, config_name)</span>
</code></dt>
<dd>
<div class="desc"><p>Retrieve the logger config associated with the specified name.</p>
<blockquote>
<p _..._="[...]" _readers_:="&quot;readers&quot;:" _transforms_:="&quot;transforms&quot;:" _writers_:="&quot;writers&quot;:">api.get_logger_config('knud-&gt;net')</p>
</blockquote></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def get_logger_config(self, config_name):
    &#34;&#34;&#34;Retrieve the logger config associated with the specified name.
    &gt; api.get_logger_config(&#39;knud-&gt;net&#39;)
           { &#34;readers&#34;: [...], &#34;transforms&#34;: [...], &#34;writers&#34;: [...] }
    &#34;&#34;&#34;
    raise NotImplementedError(&#39;get_logger_config must be implemented by subclass&#39;)</code></pre>
</details>
</dd>
<dt id="server.server_api.ServerAPI.get_logger_config_name"><code class="name flex">
<span>def <span class="ident">get_logger_config_name</span></span>(<span>self, logger_id, mode=None)</span>
</code></dt>
<dd>
<div class="desc"><p>Retrieve the name of the logger config associated with the
specified logger in the specified mode. If mode is omitted,
retrieve config name associated with the active mode.</p>
<blockquote>
<p>api.get_logger_config_name('knud')
knud-&gt;net</p>
</blockquote></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def get_logger_config_name(self, logger_id, mode=None):
    &#34;&#34;&#34;Retrieve the name of the logger config associated with the
    specified logger in the specified mode. If mode is omitted,
    retrieve config name associated with the active mode.
    &gt; api.get_logger_config_name(&#39;knud&#39;)
        knud-&gt;net
   &#34;&#34;&#34;
    raise NotImplementedError(
        &#39;get_logger_config_name must be implemented by subclass&#39;)</code></pre>
</details>
</dd>
<dt id="server.server_api.ServerAPI.get_logger_config_names"><code class="name flex">
<span>def <span class="ident">get_logger_config_names</span></span>(<span>self, logger_id)</span>
</code></dt>
<dd>
<div class="desc"><p>Retrieve list of logger config names for the specified logger.</p>
<blockquote>
<p>api.get_logger_config_names('knud')
["off", "knud-&gt;net", "knud-&gt;net/file", "knud-&gt;net/file/db"]</p>
</blockquote></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def get_logger_config_names(self, logger_id):
    &#34;&#34;&#34;Retrieve list of logger config names for the specified logger.
    &gt; api.get_logger_config_names(&#39;knud&#39;)
        [&#34;off&#34;, &#34;knud-&gt;net&#34;, &#34;knud-&gt;net/file&#34;, &#34;knud-&gt;net/file/db&#34;]
    &#34;&#34;&#34;
    raise NotImplementedError(
        &#39;get_logger_config_names must be implemented by subclass&#39;)</code></pre>
</details>
</dd>
<dt id="server.server_api.ServerAPI.get_logger_configs"><code class="name flex">
<span>def <span class="ident">get_logger_configs</span></span>(<span>self, mode=None)</span>
</code></dt>
<dd>
<div class="desc"><p>Retrieve the configs associated with a mode from the data store.
If mode is omitted, retrieve configs associated with the active mode.</p>
<blockquote>
<p>api.get_logger_configs()
{"knud": { config_spec },
"gyr1": { config_spec }
}</p>
</blockquote></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def get_logger_configs(self, mode=None):
    &#34;&#34;&#34;Retrieve the configs associated with a mode from the data store.
    If mode is omitted, retrieve configs associated with the active mode.
    &gt; api.get_logger_configs()
           {&#34;knud&#34;: { config_spec },
            &#34;gyr1&#34;: { config_spec }
           }
    &#34;&#34;&#34;
    raise NotImplementedError(&#39;get_logger_configs must be implemented by subclass&#39;)</code></pre>
</details>
</dd>
<dt id="server.server_api.ServerAPI.get_loggers"><code class="name flex">
<span>def <span class="ident">get_loggers</span></span>(<span>self)</span>
</code></dt>
<dd>
<div class="desc"><p>Get the dict of {logger_id:logger_spec,&hellip;} from the data store.</p>
<blockquote>
<p>api.get_loggers()
{
"knud": {"host": "knud.pi", "configs":&hellip;},
"gyr1": {"configs":&hellip;}
}</p>
</blockquote></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def get_loggers(self):
    &#34;&#34;&#34;Get the dict of {logger_id:logger_spec,...} from the data store.
    &gt; api.get_loggers()
        {
          &#34;knud&#34;: {&#34;host&#34;: &#34;knud.pi&#34;, &#34;configs&#34;:...},
          &#34;gyr1&#34;: {&#34;configs&#34;:...}
        }
    &#34;&#34;&#34;
    raise NotImplementedError(&#39;get_loggers must be implemented by subclass&#39;)</code></pre>
</details>
</dd>
<dt id="server.server_api.ServerAPI.get_message_log"><code class="name flex">
<span>def <span class="ident">get_message_log</span></span>(<span>self, source=None, user=None, log_level=9223372036854775807, since_timestamp=None)</span>
</code></dt>
<dd>
<div class="desc"><p>Retrieve log messages from source at or above log_level since
timestamp. If source is omitted, retrieve from all sources. If
log_level is omitted, retrieve at all levels. If since_timestamp is
omitted, only retrieve most recent message.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def get_message_log(self, source=None, user=None, log_level=sys.maxsize,
                    since_timestamp=None):
    &#34;&#34;&#34;Retrieve log messages from source at or above log_level since
    timestamp. If source is omitted, retrieve from all sources. If
    log_level is omitted, retrieve at all levels. If since_timestamp is
    omitted, only retrieve most recent message.
    &#34;&#34;&#34;
    raise NotImplementedError(&#39;get_message_log must be implemented by subclass&#39;)</code></pre>
</details>
</dd>
<dt id="server.server_api.ServerAPI.get_modes"><code class="name flex">
<span>def <span class="ident">get_modes</span></span>(<span>self)</span>
</code></dt>
<dd>
<div class="desc"><p>Get the list of modes from the data store.</p>
<blockquote>
<p>api.get_modes()
["off", "port", "underway"]</p>
</blockquote></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def get_modes(self):
    &#34;&#34;&#34;Get the list of modes from the data store.
    &gt; api.get_modes()
        [&#34;off&#34;, &#34;port&#34;, &#34;underway&#34;]
    &#34;&#34;&#34;
    raise NotImplementedError(&#39;get_modes must be implemented by subclass&#39;)</code></pre>
</details>
</dd>
<dt id="server.server_api.ServerAPI.get_status"><code class="name flex">
<span>def <span class="ident">get_status</span></span>(<span>self, since_timestamp=None)</span>
</code></dt>
<dd>
<div class="desc"><p>Retrieve a dict of the most-recent status report from each
logger. If since_timestamp is specified, retrieve all status reports
since that time.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def get_status(self, since_timestamp=None):
    &#34;&#34;&#34;Retrieve a dict of the most-recent status report from each
    logger. If since_timestamp is specified, retrieve all status reports
    since that time.&#34;&#34;&#34;
    raise NotImplementedError(&#39;get_status must be implemented by subclass&#39;)</code></pre>
</details>
</dd>
<dt id="server.server_api.ServerAPI.load_configuration"><code class="name flex">
<span>def <span class="ident">load_configuration</span></span>(<span>self, configuration)</span>
</code></dt>
<dd>
<div class="desc"><p>Load a complete cruise configuration to the data store.</p>
<blockquote>
<p>api.load_configuration({ configuration })</p>
</blockquote></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def load_configuration(self, configuration):
    &#34;&#34;&#34;Load a complete cruise configuration to the data store.
    &gt; api.load_configuration({ configuration })
    &#34;&#34;&#34;
    raise NotImplementedError(&#39;load_configuration must be implemented by subclass&#39;)</code></pre>
</details>
</dd>
<dt id="server.server_api.ServerAPI.message_log"><code class="name flex">
<span>def <span class="ident">message_log</span></span>(<span>self, source, user, log_level, message)</span>
</code></dt>
<dd>
<div class="desc"><p>Timestamp and store the passed message.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def message_log(self, source, user, log_level, message):
    &#34;&#34;&#34;Timestamp and store the passed message.&#34;&#34;&#34;
    raise NotImplementedError(&#39;message_log must be implemented by subclass&#39;)</code></pre>
</details>
</dd>
<dt id="server.server_api.ServerAPI.on_load"><code class="name flex">
<span>def <span class="ident">on_load</span></span>(<span>self, callback, kwargs=None)</span>
</code></dt>
<dd>
<div class="desc"><p>Register a method to be called when new configs have been loaded.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def on_load(self, callback, kwargs=None):
    &#34;&#34;&#34;Register a method to be called when new configs have been loaded.&#34;&#34;&#34;
    if kwargs is None:
        kwargs = {}
    self.load_callbacks.append((callback, kwargs))</code></pre>
</details>
</dd>
<dt id="server.server_api.ServerAPI.on_quit"><code class="name flex">
<span>def <span class="ident">on_quit</span></span>(<span>self, callback, kwargs=None)</span>
</code></dt>
<dd>
<div class="desc"><p>Register a method to be called when quit is signaled changes.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def on_quit(self, callback, kwargs=None):
    &#34;&#34;&#34;Register a method to be called when quit is signaled changes.&#34;&#34;&#34;
    if kwargs is None:
        kwargs = {}
    self.quit_callbacks.append((callback, kwargs))</code></pre>
</details>
</dd>
<dt id="server.server_api.ServerAPI.on_update"><code class="name flex">
<span>def <span class="ident">on_update</span></span>(<span>self, callback, kwargs=None)</span>
</code></dt>
<dd>
<div class="desc"><p>Register a method to be called when current configs change.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def on_update(self, callback, kwargs=None):
    &#34;&#34;&#34;Register a method to be called when current configs change.&#34;&#34;&#34;
    if kwargs is None:
        kwargs = {}
    self.update_callbacks.append((callback, kwargs))</code></pre>
</details>
</dd>
<dt id="server.server_api.ServerAPI.quit"><code class="name flex">
<span>def <span class="ident">quit</span></span>(<span>self)</span>
</code></dt>
<dd>
<div class="desc"><p>Execute any callbacks that were registered to run on quit.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def quit(self):
    &#34;&#34;&#34;Execute any callbacks that were registered to run on quit.&#34;&#34;&#34;
    for (callback, kwargs) in self.quit_callbacks:
        logging.debug(&#39;Executing quit callback: %s&#39;, callback)
        callback(**kwargs)</code></pre>
</details>
</dd>
<dt id="server.server_api.ServerAPI.set_active_logger_config"><code class="name flex">
<span>def <span class="ident">set_active_logger_config</span></span>(<span>self, logger, config_name)</span>
</code></dt>
<dd>
<div class="desc"><p>Set the active logger config for the specified logger to
the specific logger_config name.</p>
<blockquote>
<p>api.set_active_logger_config('knud', 'knud-&gt;file/net/db')</p>
</blockquote></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def set_active_logger_config(self, logger, config_name):
    &#34;&#34;&#34;Set the active logger config for the specified logger to
    the specific logger_config name.
    &gt; api.set_active_logger_config(&#39;knud&#39;, &#39;knud-&gt;file/net/db&#39;)
    &#34;&#34;&#34;
    raise NotImplementedError(
        &#39;set_active_logger_config must be implemented by subclass&#39;)</code></pre>
</details>
</dd>
<dt id="server.server_api.ServerAPI.set_active_mode"><code class="name flex">
<span>def <span class="ident">set_active_mode</span></span>(<span>self, mode)</span>
</code></dt>
<dd>
<div class="desc"><p>Set the active mode for OpenRVDAS.</p>
<blockquote>
<p>api.set_active_mode(port')</p>
</blockquote></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def set_active_mode(self, mode):
    &#34;&#34;&#34;Set the active mode for OpenRVDAS.
    &gt; api.set_active_mode(port&#39;)
    &#34;&#34;&#34;
    raise NotImplementedError(&#39;set_active_mode must be implemented by subclass&#39;)</code></pre>
</details>
</dd>
<dt id="server.server_api.ServerAPI.signal_load"><code class="name flex">
<span>def <span class="ident">signal_load</span></span>(<span>self)</span>
</code></dt>
<dd>
<div class="desc"><p>Call the registered methods when new configs have been loaded.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def signal_load(self):
    &#34;&#34;&#34;Call the registered methods when new configs have been loaded.&#34;&#34;&#34;
    for (callback, kwargs) in self.load_callbacks:
        logging.debug(&#39;Executing load callback: %s&#39;, callback)
        callback(**kwargs)</code></pre>
</details>
</dd>
<dt id="server.server_api.ServerAPI.signal_update"><code class="name flex">
<span>def <span class="ident">signal_update</span></span>(<span>self)</span>
</code></dt>
<dd>
<div class="desc"><p>Call the registered methods when current configs change.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def signal_update(self):
    &#34;&#34;&#34;Call the registered methods when current configs change.&#34;&#34;&#34;
    for (callback, kwargs) in self.update_callbacks:
        logging.debug(&#39;Executing update callback: %s&#39;, callback)
        callback(**kwargs)</code></pre>
</details>
</dd>
</dl>
</dd>
</dl>
</section>
</article>
<nav id="sidebar">
<h1>Index</h1>
<div class="toc">
<ul></ul>
</div>
<ul id="index">
<li><h3>Super-module</h3>
<ul>
<li><code><a title="server" href="index.html">server</a></code></li>
</ul>
</li>
<li><h3><a href="#header-classes">Classes</a></h3>
<ul>
<li>
<h4><code><a title="server.server_api.ServerAPI" href="#server.server_api.ServerAPI">ServerAPI</a></code></h4>
<ul class="">
<li><code><a title="server.server_api.ServerAPI.CRITICAL" href="#server.server_api.ServerAPI.CRITICAL">CRITICAL</a></code></li>
<li><code><a title="server.server_api.ServerAPI.DEBUG" href="#server.server_api.ServerAPI.DEBUG">DEBUG</a></code></li>
<li><code><a title="server.server_api.ServerAPI.ERROR" href="#server.server_api.ServerAPI.ERROR">ERROR</a></code></li>
<li><code><a title="server.server_api.ServerAPI.INFO" href="#server.server_api.ServerAPI.INFO">INFO</a></code></li>
<li><code><a title="server.server_api.ServerAPI.WARNING" href="#server.server_api.ServerAPI.WARNING">WARNING</a></code></li>
<li><code><a title="server.server_api.ServerAPI.add_logger" href="#server.server_api.ServerAPI.add_logger">add_logger</a></code></li>
<li><code><a title="server.server_api.ServerAPI.add_logger_config" href="#server.server_api.ServerAPI.add_logger_config">add_logger_config</a></code></li>
<li><code><a title="server.server_api.ServerAPI.add_logger_config_to_logger" href="#server.server_api.ServerAPI.add_logger_config_to_logger">add_logger_config_to_logger</a></code></li>
<li><code><a title="server.server_api.ServerAPI.add_logger_config_to_mode" href="#server.server_api.ServerAPI.add_logger_config_to_mode">add_logger_config_to_mode</a></code></li>
<li><code><a title="server.server_api.ServerAPI.add_mode" href="#server.server_api.ServerAPI.add_mode">add_mode</a></code></li>
<li><code><a title="server.server_api.ServerAPI.delete_configuration" href="#server.server_api.ServerAPI.delete_configuration">delete_configuration</a></code></li>
<li><code><a title="server.server_api.ServerAPI.delete_logger" href="#server.server_api.ServerAPI.delete_logger">delete_logger</a></code></li>
<li><code><a title="server.server_api.ServerAPI.delete_logger_config" href="#server.server_api.ServerAPI.delete_logger_config">delete_logger_config</a></code></li>
<li><code><a title="server.server_api.ServerAPI.delete_mode" href="#server.server_api.ServerAPI.delete_mode">delete_mode</a></code></li>
<li><code><a title="server.server_api.ServerAPI.get_active_mode" href="#server.server_api.ServerAPI.get_active_mode">get_active_mode</a></code></li>
<li><code><a title="server.server_api.ServerAPI.get_configuration" href="#server.server_api.ServerAPI.get_configuration">get_configuration</a></code></li>
<li><code><a title="server.server_api.ServerAPI.get_default_mode" href="#server.server_api.ServerAPI.get_default_mode">get_default_mode</a></code></li>
<li><code><a title="server.server_api.ServerAPI.get_logger" href="#server.server_api.ServerAPI.get_logger">get_logger</a></code></li>
<li><code><a title="server.server_api.ServerAPI.get_logger_config" href="#server.server_api.ServerAPI.get_logger_config">get_logger_config</a></code></li>
<li><code><a title="server.server_api.ServerAPI.get_logger_config_name" href="#server.server_api.ServerAPI.get_logger_config_name">get_logger_config_name</a></code></li>
<li><code><a title="server.server_api.ServerAPI.get_logger_config_names" href="#server.server_api.ServerAPI.get_logger_config_names">get_logger_config_names</a></code></li>
<li><code><a title="server.server_api.ServerAPI.get_logger_configs" href="#server.server_api.ServerAPI.get_logger_configs">get_logger_configs</a></code></li>
<li><code><a title="server.server_api.ServerAPI.get_loggers" href="#server.server_api.ServerAPI.get_loggers">get_loggers</a></code></li>
<li><code><a title="server.server_api.ServerAPI.get_message_log" href="#server.server_api.ServerAPI.get_message_log">get_message_log</a></code></li>
<li><code><a title="server.server_api.ServerAPI.get_modes" href="#server.server_api.ServerAPI.get_modes">get_modes</a></code></li>
<li><code><a title="server.server_api.ServerAPI.get_status" href="#server.server_api.ServerAPI.get_status">get_status</a></code></li>
<li><code><a title="server.server_api.ServerAPI.load_configuration" href="#server.server_api.ServerAPI.load_configuration">load_configuration</a></code></li>
<li><code><a title="server.server_api.ServerAPI.message_log" href="#server.server_api.ServerAPI.message_log">message_log</a></code></li>
<li><code><a title="server.server_api.ServerAPI.on_load" href="#server.server_api.ServerAPI.on_load">on_load</a></code></li>
<li><code><a title="server.server_api.ServerAPI.on_quit" href="#server.server_api.ServerAPI.on_quit">on_quit</a></code></li>
<li><code><a title="server.server_api.ServerAPI.on_update" href="#server.server_api.ServerAPI.on_update">on_update</a></code></li>
<li><code><a title="server.server_api.ServerAPI.quit" href="#server.server_api.ServerAPI.quit">quit</a></code></li>
<li><code><a title="server.server_api.ServerAPI.set_active_logger_config" href="#server.server_api.ServerAPI.set_active_logger_config">set_active_logger_config</a></code></li>
<li><code><a title="server.server_api.ServerAPI.set_active_mode" href="#server.server_api.ServerAPI.set_active_mode">set_active_mode</a></code></li>
<li><code><a title="server.server_api.ServerAPI.signal_load" href="#server.server_api.ServerAPI.signal_load">signal_load</a></code></li>
<li><code><a title="server.server_api.ServerAPI.signal_update" href="#server.server_api.ServerAPI.signal_update">signal_update</a></code></li>
</ul>
</li>
</ul>
</li>
</ul>
</nav>
</main>
<footer id="footer">
<p>Generated by <a href="https://pdoc3.github.io/pdoc" title="pdoc: Python API documentation generator"><cite>pdoc</cite> 0.10.0</a>.</p>
</footer>
</body>
</html>